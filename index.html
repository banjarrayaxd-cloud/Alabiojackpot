<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ALABIO Pangkalan Sari Slot + Live Chat</title>
<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:radial-gradient(circle,#0f2027,#203a43,#2c5364);
  color:white;
  text-align:center;
  overflow-x:hidden;
}
.box{
  max-width:500px;
  margin:30px auto;
  background:#2b0000;
  padding:20px;
  border-radius:12px;
}
.form-group{ margin-bottom:12px; text-align:left; }
.form-group label{ display:block; margin-bottom:5px; font-size:14px; }
.form-group input, .form-group select{ width:100%; padding:10px; border:none; border-radius:8px; }

h1{margin:10px;color:gold;text-shadow:0 0 15px gold;}
button{cursor:pointer;}

/* GAME BOX */
#gameBox{display:none; max-width:1000px; margin:0 auto;}
.topbar{display:flex;justify-content:space-around;font-size:14px;padding:8px;}
.slot{display:flex;justify-content:center;margin:20px auto;}
.reel{width:70px;height:280px;overflow:hidden;border:2px solid gold;border-radius:10px;margin:0 5px;background:#111;position:relative;}
.reel-inner{position:absolute;width:100%;}
.symbol{height:70px;display:flex;align-items:center;justify-content:center;font-size:26px;background:linear-gradient(#ffd700,#b8860b);color:black;border-bottom:1px solid #333;}
.controls button{padding:8px 15px;margin:5px;border:none;border-radius:8px;transition:0.1s;}
.controls button.bet.selected{background:orange; transform:scale(1.1);}
.spin{background:red;color:white;font-size:18px;transition:0.1s;}
.spin:active{transform:scale(0.95);box-shadow:0 0 10px gold inset;}
.bigwin{position:fixed;top:40%;left:50%;transform:translate(-50%,-50%);font-size:45px;font-weight:bold;color:gold;display:none;text-shadow:0 0 20px gold;}
.bonus-mode{background: linear-gradient(45deg, gold, orange);}
#logoutBtn{padding:5px 12px;margin-top:5px;border:none;border-radius:5px;background:#ff3333;color:white;cursor:pointer;}
#history{max-height:150px;overflow-y:auto;margin-top:15px;background:rgba(255,255,255,0.1);padding:10px;border-radius:8px;text-align:left;}

/* CHAT */
#chatContainer{margin-top:20px;text-align:left;background:rgba(0,0,0,0.2);border-radius:10px;padding:10px;max-height:400px;overflow-y:auto;}
.chat-bubble{padding:8px 12px;margin:5px 10px;border-radius:15px;display:inline-block;max-width:75%;position:relative;}
.chat-other{background:#ddd;color:black; border-bottom-left-radius:0;}
.chat-me{background:gold;color:black; border-bottom-right-radius:0; margin-left:auto;}
.chat-time{font-size:10px; color:#333; margin-top:2px;}
#chatInputContainer{display:flex;margin-top:5px;}
#chatInputContainer input{flex:1;padding:8px;border-radius:20px;border:none;}
#chatInputContainer button{padding:8px 15px;margin-left:5px;border:none;border-radius:20px;background:#ff6600;color:white;cursor:pointer;}
  /* ===== SIDEBAR ===== */
.sidebar{
  position:fixed;
  top:0;
  left:-270px;
  width:260px;
  height:100%;
  background:linear-gradient(180deg,#111,#000);
  transition:0.4s ease;
  z-index:3000;
  box-shadow:4px 0 15px rgba(0,0,0,0.8);
  overflow-y:auto;
}

.sidebar.active{
  left:0;
}

.sidebar-header{
  background:linear-gradient(90deg,gold,#ffcc00);
  color:black;
  padding:15px;
  font-weight:bold;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}

.chat-badge{
  background:red;
  color:white;
  font-size:12px;
  padding:2px 6px;
  border-radius:10px;
}

.menu-list a{
  display:block;
  padding:14px 18px;
  color:white;
  text-decoration:none;
  border-bottom:1px solid #222;
  transition:0.3s;
}

.menu-list a:hover{
  background:gold;
  color:black;
  padding-left:25px;
}

.menu-btn{
  position:fixed;
  top:15px;
  left:15px;
  background:gold;
  color:black;
  padding:6px 12px;
  border-radius:5px;
  cursor:pointer;
  z-index:3500;
  font-weight:bold;
  }
  #depositBox,
#withdrawBox{
  position: fixed;
  top: 120px;
  left: 50%;
  transform: translateX(-50%);
  background: #111;
  padding: 20px;
  border-radius: 10px;
  z-index: 9999;
}
</style>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>
 <div class="menu-btn" onclick="openMenu()">‚ò∞</div>

<div class="sidebar" id="sidebar">

  <div class="sidebar-header" onclick="toggleChat()">
    <div>üí¨ Live Chat</div>
    <div>
      <span class="chat-badge" id="chatBadge">0</span>
    </div>
  </div>

  <div class="menu-list">
    <a href="#">üìú History</a>
    <a href="javascript:void(0);" onclick="showDeposit()">üí∞ Deposit</a>
<a href="javascript:void(0);" onclick="showWithdraw()">üèß Withdraw</a>
    <a href="#">üéÅ Bonus</a>
    <a href="#">üéâ Promosi</a>
    <a href="#" onclick="logoutUser()">üö™ Logout</a>
  </div>

</div>

<h1>üé∞ ALABIO TOTO</h1>

<!-- REGISTER BOX -->
<div id="registerBox" class="box">
<h2>Register</h2>
<div class="form-group">
  <label>Username *</label>
  <input type="text" id="regUsername" placeholder="Username">
</div>
<div class="form-group">
  <label>Password *</label>
  <input type="password" id="regPassword" placeholder="Password">
</div>
<div class="form-group">
  <label>Konfirmasi Password *</label>
  <input type="password" id="regConfirm" placeholder="Konfirmasi Password">
</div>
<div class="form-group">
  <label>Email *</label>
  <input type="email" id="regEmail" placeholder="Alamat email anda">
</div>
<div class="form-group">
  <label>No. Telp/HP *</label>
  <div style="display:flex;">
    <span style="background:orange;padding:10px;border-radius:8px 0 0 8px;">+62</span>
    <input type="text" id="regPhone" placeholder="Nomor telepon anda" style="border-radius:0 8px 8px 0;">
  </div>
</div>
<h3>Pengaturan Bank</h3>
<div class="form-group">
  <label>Nama Bank *</label>
  <select id="regBank">
    <option>BCA</option><option>BRI</option><option>BNI</option>
    <option>MANDIRI</option><option>DANA</option><option>OVO</option><option>GOPAY</option>
  </select>
</div>
<div class="form-group">
  <label>Nama Rekening *</label>
  <input type="text" id="regRekName">
</div>
<div class="form-group">
  <label>Nomor Rekening *</label>
  <input type="text" id="regRekNo">
</div>
<div class="form-group">
  <label>Captcha *</label>
  <div style="display:flex;align-items:center;">
    <span id="captchaText" style="background:#cde;padding:10px;font-weight:bold;"></span>
    <button type="button" onclick="generateCaptcha()" style="margin-left:5px;">‚Üª</button>
  </div>
  <input type="text" id="captchaInput" placeholder="Masukkan captcha">
</div>
<button onclick="submitRegister()">DAFTAR</button>
<p style="margin-top:10px;">Sudah punya akun? <span style="color:orange; cursor:pointer;" onclick="showLogin()">Login disini</span></p>
</div>

<!-- LOGIN BOX -->
<div id="loginBox" class="box" style="display:none;">
<h2>Login</h2>
<div class="form-group">
  <label>Email</label>
  <input type="email" id="loginEmail" placeholder="Email">
</div>
<div class="form-group">
  <label>Password</label>
  <input type="password" id="loginPass" placeholder="Password">
</div>
<button onclick="loginUser()">LOGIN</button>
<p style="margin-top:10px;">Belum punya akun? <span style="color:orange; cursor:pointer;" onclick="showRegister()">Register disini</span></p>
</div>

<!-- GAME BOX -->
<div id="gameBox">
<h2>üé∞ Slot Game</h2>
<p>Saldo: <span id="balance"></span> | Bet: <span id="bet"></span></p>
<button id="logoutBtn" onclick="logoutUser()">Logout</button>
<div class="slot" id="slot"></div>
<button class="spin" onclick="spin()">SPIN</button>
<div id="bigwin" class="bigwin">BIG WIN!</div>
<div id="history"></div>
<div id="chatContainer"></div>
<div id="chatInputContainer">
  <input type="text" id="chatInput" placeholder="Tulis pesan...">
  <button onclick="sendMessage()">KIRIM</button>
</div>
</div>
<!-- DEPOSIT BOX -->
<!-- DEPOSIT BOX -->
<div id="depositBox" class="box" style="display:none;">
  <h2>üí∞ Deposit</h2>
  <input type="number" id="depositAmount" placeholder="Masukkan jumlah">
  <br><br>
  <button onclick="submitDeposit()">Kirim Deposit</button>
  <br><br>
  <button onclick="closeDeposit()">Tutup</button>
</div>

<!-- WITHDRAW BOX -->
<div id="withdrawBox" class="box" style="display:none;">
  <h2>üèß Withdraw</h2>
  <input type="number" id="withdrawAmount" placeholder="Masukkan jumlah">
  <br><br>
  <button onclick="submitWithdraw()">Kirim Withdraw</button>
  <br><br>
  <button onclick="closeWithdraw()">Tutup</button>
</div>
</div>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyClAxn0V3k-0taY76A4HN1qS4_o483ba8U",
  authDomain: "alabio-slot.firebaseapp.com",
  projectId: "alabio-slot",
  storageBucket: "alabio-slot.firebasestorage.app",
  messagingSenderId: "418392865685",
  appId: "1:418392865685:web:50a233aad7e8d32712949c"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let balance = 0;
let bet = 1000;
let freeSpins = 0;
let bonusMode = false;
const symbols=["üÄÑ","üÄÖ","üÄÜ","üÄá","üÄà","üÄâ","üíé"];
const slot=document.getElementById("slot");
const balanceEl=document.getElementById("balance");
const betEl=document.getElementById("bet");
const bigwinEl=document.getElementById("bigwin");
const registerBox=document.getElementById("registerBox");
const loginBox=document.getElementById("loginBox");
const gameBox=document.getElementById("gameBox");
const historyDiv=document.getElementById("history");
const chatContainer=document.getElementById("chatContainer");
const chatInput=document.getElementById("chatInput");

let currentCaptcha="";
function generateCaptcha(){
  const chars="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
  currentCaptcha="";
  for(let i=0;i<5;i++){
    currentCaptcha+=chars.charAt(Math.floor(Math.random()*chars.length));
  }
  document.getElementById("captchaText").innerText=currentCaptcha;
}
window.onload=function(){ generateCaptcha(); createReels(); updateUI(); }

function submitRegister(){
  let username=document.getElementById("regUsername").value;
  let email=document.getElementById("regEmail").value;
  let pass=document.getElementById("regPassword").value;
  let confirm=document.getElementById("regConfirm").value;
  let phone=document.getElementById("regPhone").value;
  let bank=document.getElementById("regBank").value;
  let rekName=document.getElementById("regRekName").value;
  let rekNo=document.getElementById("regRekNo").value;
  let captchaInput=document.getElementById("captchaInput").value;

  if(!username || !email || !pass || !phone){
    alert("Isi semua data wajib!");
    return;
  }
  if(pass!==confirm){
    alert("Password tidak sama!");
    return;
  }
  if(captchaInput!==currentCaptcha){
    alert("Captcha salah!");
    generateCaptcha();
    return;
  }

  auth.createUserWithEmailAndPassword(email, pass)
  .then(cred=>{
    db.collection("users").doc(cred.user.uid).set({
      username,email,phone,bank,rekName,rekNo,balance:10000,createdAt:Date.now()
    });
    alert("Register berhasil üî• Silakan login");
    registerBox.style.display="none";
    loginBox.style.display="block";
    generateCaptcha();
  })
  .catch(err=>{ alert("Gagal register: "+err.message); });
}

function showLogin(){ registerBox.style.display="none"; loginBox.style.display="block"; }
function showRegister(){ registerBox.style.display="block"; loginBox.style.display="none"; }

function loginUser(){
  const email=document.getElementById("loginEmail").value;
  const pass=document.getElementById("loginPass").value;
  if(!email || !pass){ alert("Isi email & password!"); return; }
  auth.signInWithEmailAndPassword(email, pass)
  .then(cred=>{
    alert("Login sukses: "+cred.user.email);
    loginBox.style.display="none";
    gameBox.style.display="block";
    initUser(cred.user);
  })
  .catch(err=>alert("Gagal login: "+err.message));
}

function logoutUser(){
  auth.signOut().then(()=>{
    gameBox.style.display="none";
    loginBox.style.display="block";
    closeMenu(); // üî• ini yang bikin sidebar nutup
  });
    }
function initUser(user){
  const userDoc=db.collection("users").doc(user.uid);
  userDoc.get().then(doc=>{
    if(doc.exists) balance=doc.data().balance; else { userDoc.set({balance:1000000}); balance=1000000; }
    updateUI();
    loadHistory(user.uid);
    loadChat();
  });
}

function updateUI(){ balanceEl.innerText="Rp "+balance.toLocaleString("id-ID"); betEl.innerText="Rp "+bet.toLocaleString("id-ID"); }

function randomSymbol(){ return symbols[Math.floor(Math.random()*symbols.length)]; }
function createReels(){
  slot.innerHTML="";
  for(let i=0;i<5;i++){
    const reel=document.createElement("div"); reel.className="reel";
    const inner=document.createElement("div"); inner.className="reel-inner";
    for(let j=0;j<10;j++){ const sym=document.createElement("div"); sym.className="symbol"; sym.innerText=randomSymbol(); inner.appendChild(sym); }
    reel.appendChild(inner); slot.appendChild(reel);
  }
}

function spin(){
  if(balance<bet && freeSpins===0) return alert("Saldo habis!");
  if(freeSpins===0) balance-=bet; else {freeSpins--; alert("üéÅ FREE SPIN! Sisa: "+freeSpins);}
  updateUI();
  const reels=document.querySelectorAll(".reel-inner");
  let crownCount=0;
  reels.forEach((reel,index)=>{
    reel.style.transition="none"; reel.style.top="0px";
    setTimeout(()=>{ reel.style.transition="top 1s ease-out"; reel.style.top="-350px"; }, index*200);
    setTimeout(()=>{
      reel.style.transition="none"; reel.style.top="0px"; reel.innerHTML="";
      for(let j=0;j<10;j++){ const sym=document.createElement("div"); sym.className="symbol"; sym.innerText=randomSymbol(); reel.appendChild(sym); if(sym.innerText==="üíé") crownCount++; }
    },1200+index*200);
  });
  setTimeout(()=>{
    let winAmount=0;
    if(crownCount>=3){ freeSpins+=5; bonusMode=true; document.body.classList.add("bonus-mode"); alert("üî• FREE SPIN MODE AKTIF! 5 SPIN + WIN x10"); }
    let winChance=Math.random();
    if(winChance>0.7){ let multiplier=bonusMode?10:5; winAmount=bet*multiplier; balance+=winAmount; bigwinEl.style.display="block"; setTimeout(()=>bigwinEl.style.display="none",1500); updateUI(); }
    if(freeSpins===0){ bonusMode=false; document.body.classList.remove("bonus-mode"); }
    const user=auth.currentUser;
    if(user){
      const userRef=db.collection("users").doc(user.uid);
      userRef.set({balance:balance});
      const spinData={timestamp:Date.now(),bet:bet,win:winAmount};
      userRef.collection("history").add(spinData).then(()=>loadHistory(user.uid));
    }
  },1800);
}

function loadHistory(uid){
  historyDiv.innerHTML="";
  db.collection("users").doc(uid).collection("history").orderBy("timestamp","desc").limit(20).get()
  .then(snapshot=>{ snapshot.forEach(doc=>{ const data=doc.data(); const time=new Date(data.timestamp).toLocaleTimeString(); const entry=document.createElement("div"); entry.innerText=`[${time}] Bet: ${data.bet} | Win: ${data.win}`; historyDiv.appendChild(entry); }); });
}

function sendMessage(){
  const msg=chatInput.value.trim();
  if(!msg) return;
  const user=auth.currentUser;
  if(!user) return alert("Login dulu untuk chat!");
  db.collection("chat").add({user:user.email,message:msg,timestamp:Date.now()}).then(()=>chatInput.value="");
}

function loadChat(){
  db.collection("chat").orderBy("timestamp","asc").onSnapshot(snapshot=>{
    chatContainer.innerHTML="";
    snapshot.forEach(doc=>{
      const data=doc.data();
      const time=new Date(data.timestamp).toLocaleTimeString();
      const bubble=document.createElement("div");
      bubble.className=data.user===auth.currentUser.email ? "chat-bubble chat-me" : "chat-bubble chat-other";
      bubble.innerHTML=`${data.message}<div class="chat-time">${time}</div>`;
      chatContainer.appendChild(bubble);
      chatContainer.scrollTop=chatContainer.scrollHeight;
    });
  });
}
function openMenu(){
  document.getElementById("sidebar").classList.add("active");
}

function closeMenu(){
  document.getElementById("sidebar").classList.remove("active");
}

function toggleChat(){
  document.getElementById("chatContainer").scrollIntoView({behavior:"smooth"});
  closeMenu();
    } 
function showDeposit(){
  document.getElementById("depositBox").style.display="block";
  document.getElementById("withdrawBox").style.display="none";
  closeMenu();
}

function showWithdraw(){
  document.getElementById("withdrawBox").style.display="block";
  document.getElementById("depositBox").style.display="none";
  closeMenu();
}

function submitDeposit(){
  const amount = parseInt(document.getElementById("depositAmount").value);
  if(!amount || amount <= 0) return alert("Masukkan jumlah valid!");

  const user = auth.currentUser;
  if(!user) return alert("Login dulu!");

  const userRef = db.collection("users").doc(user.uid);

  userRef.get().then(doc=>{
    let currentBalance = doc.data().balance || 0;
    let newBalance = currentBalance + amount;

    userRef.update({balance:newBalance}).then(()=>{
      balance = newBalance;
      updateUI();
      alert("Deposit berhasil ‚úÖ");
      document.getElementById("depositBox").style.display="none";
    });
  });
}

function submitWithdraw(){
  const amount = parseInt(document.getElementById("withdrawAmount").value);
  if(!amount || amount <= 0) return alert("Masukkan jumlah valid!");

  const user = auth.currentUser;
  if(!user) return alert("Login dulu!");

  const userRef = db.collection("users").doc(user.uid);

  userRef.get().then(doc=>{
    let currentBalance = doc.data().balance || 0;

    if(amount > currentBalance){
      alert("Saldo tidak cukup!");
      return;
    }

    let newBalance = currentBalance - amount;

    userRef.update({balance:newBalance}).then(()=>{
      balance = newBalance;
      updateUI();
      alert("Withdraw berhasil ‚úÖ");
      document.getElementById("withdrawBox").style.display="none";
    });
  });
}  
  
</script>
</body>
</html>
