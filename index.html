<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ALABIO Pangkalan Sari Slot + Live Chat</title>
<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:radial-gradient(circle,#0f2027,#203a43,#2c5364);
  color:white;
  text-align:center;
  overflow-x:hidden;
}
  #registerBox{
  max-width:500px;
  margin:30px auto;
  background:#2b0000;
  padding:20px;
  border-radius:12px;
}

.form-group{
  margin-bottom:12px;
  text-align:left;
}

.form-group label{
  display:block;
  margin-bottom:5px;
  font-size:14px;
}

.form-group input,
.form-group select{
  width:100%;
  padding:10px;
  border:none;
  border-radius:8px;
}
h1{margin:10px;color:gold;text-shadow:0 0 15px gold;}
#login-form{margin-top:50px;}
#login-form input{padding:8px;margin:5px;border-radius:5px;border:none;font-size:16px;}
#login-form button{padding:8px 15px;margin:5px;border:none;border-radius:8px;background:#ff6600;color:white;cursor:pointer;}
#gameBox{display:none; max-width:1000px; margin:0 auto;}
.topbar{display:flex;justify-content:space-around;font-size:14px;padding:8px;}
.slot{display:flex;justify-content:center;margin:20px auto;}
.reel{width:70px;height:280px;overflow:hidden;border:2px solid gold;border-radius:10px;margin:0 5px;background:#111;position:relative;}
.reel-inner{position:absolute;width:100%;}
.symbol{height:70px;display:flex;align-items:center;justify-content:center;font-size:26px;background:linear-gradient(#ffd700,#b8860b);color:black;border-bottom:1px solid #333;}
.controls button{padding:8px 15px;margin:5px;border:none;border-radius:8px;cursor:pointer;transition:0.1s;}
.controls button.bet.selected{background:orange; transform:scale(1.1);}
.spin{background:red;color:white;font-size:18px;transition:0.1s;}
.spin:active{transform:scale(0.95);box-shadow:0 0 10px gold inset;}
.bigwin{position:fixed;top:40%;left:50%;transform:translate(-50%,-50%);font-size:45px;font-weight:bold;color:gold;display:none;text-shadow:0 0 20px gold;}
.bonus-mode{background: linear-gradient(45deg, gold, orange);}
#logoutBtn{padding:5px 12px;margin-top:5px;border:none;border-radius:5px;background:#ff3333;color:white;cursor:pointer;}
#history{max-height:150px;overflow-y:auto;margin-top:15px;background:rgba(255,255,255,0.1);padding:10px;border-radius:8px;text-align:left;}

/* CHAT STYLE JODUL */
#chatContainer{margin-top:20px;text-align:left;background:rgba(0,0,0,0.2);border-radius:10px;padding:10px;max-height:400px;overflow-y:auto;}
.chat-bubble{padding:8px 12px;margin:5px 10px;border-radius:15px;display:inline-block;max-width:75%;position:relative;}
.chat-other{background:#ddd;color:black; border-bottom-left-radius:0;}
.chat-me{background:gold;color:black; border-bottom-right-radius:0; margin-left:auto;}
.chat-time{font-size:10px; color:#333; margin-top:2px;}
#chatInputContainer{display:flex;margin-top:5px;}
#chatInputContainer input{flex:1;padding:8px;border-radius:20px;border:none;}
#chatInputContainer button{padding:8px 15px;margin-left:5px;border:none;border-radius:20px;background:#ff6600;color:white;cursor:pointer;}
</style>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>

<h1>ðŸŽ° Jack slot toto</h1>

<div id="recaptcha-container"></div>
  <h2 style="color:white; text-align:left;">Register</h2>

  <div class="form-group">
    <label>Username *</label>
    <input type="text" id="regUsername" placeholder="Username">
  </div>

  <div class="form-group">
    <label>Password *</label>
    <input type="password" id="regPassword" placeholder="Password">
  </div>

  <div class="form-group">
    <label>Konfirmasi Password *</label>
    <input type="password" id="regConfirm" placeholder="Konfirmasi Password">
  </div>

  <div class="form-group">
    <label>Email *</label>
    <input type="email" id="regEmail" placeholder="Alamat email anda">
  </div>

  <div class="form-group">
    <label>No. Telp/HP *</label>
    <div style="display:flex;">
      <span style="background:orange;padding:10px;border-radius:8px 0 0 8px;">+62</span>
      <input type="text" id="regPhone" placeholder="Nomor telepon anda" style="border-radius:0 8px 8px 0;">
    </div>
  </div>

  <h3 style="margin-top:20px;">Pengaturan Bank</h3>

  <div class="form-group">
    <label>Nama Bank *</label>
    <select id="regBank">
      <option>BCA</option>
      <option>BRI</option>
      <option>BNI</option>
      <option>MANDIRI</option>
      <option>DANA</option>
      <option>OVO</option>
      <option>GOPAY</option>
    </select>
  </div>

  <div class="form-group">
    <label>Nama Rekening *</label>
    <input type="text" id="regRekName" placeholder="Nama rekening anda">
  </div>

  <div class="form-group">
    <label>Nomor Rekening *</label>
    <input type="text" id="regRekNo" placeholder="Nomor rekening">
  </div>

  <div class="form-group">
    <label>Captcha *</label>
    <div style="display:flex;align-items:center;">
      <span id="captchaText" style="background:#cde;padding:10px;font-weight:bold;"></span>
      <button onclick="generateCaptcha()" style="margin-left:5px;">â†»</button>
    </div>
    <input type="text" id="captchaInput" placeholder="Masukkan captcha">
  </div>

  <button onclick="submitRegister()" style="margin-top:15px;">DAFTAR</button>
</div>

<script>
// ===== FIREBASE =====
const firebaseConfig = {
  apiKey: "AIzaSyClAxn0V3k-0taY76A4HN1qS4_o483ba8U",
  authDomain: "alabio-slot.firebaseapp.com",
  projectId: "alabio-slot",
  storageBucket: "alabio-slot.firebasestorage.app",
  messagingSenderId: "418392865685",
  appId: "1:418392865685:web:50a233aad7e8d32712949c"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ===== SLOT VARIABLES =====
const symbols=["ðŸ€„","ðŸ€…","ðŸ€†","ðŸ€‡","ðŸ€ˆ","ðŸ€‰","ðŸ’Ž"];
let balance = 0;
let bet = 1000;
let freeSpins = 0;
let bonusMode = false;

const slot=document.getElementById("slot");
const balanceEl=document.getElementById("balance");
const betEl=document.getElementById("bet");
const bigwinEl=document.getElementById("bigwin");
const loginForm = document.getElementById("login-form");
const gameBox = document.getElementById("gameBox");
  const registerBox = document.getElementById("registerBox");
const historyDiv = document.getElementById("history");

// ===== CHAT =====
const chatContainer = document.getElementById("chatContainer");
const chatInput = document.getElementById("chatInput");

// ===== LOGIN/REGISTER =====
function registerUser(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  if(!email || !password){ alert("Isi email & password!"); return; }

  auth.createUserWithEmailAndPassword(email,password)
    .then(cred=>{
      alert("Register sukses: "+cred.user.email);
      initUser(cred.user);
    })
    .catch(err=>alert("Gagal register: "+err.message));
}

function loginUser(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  if(!email || !password){ alert("Isi email & password!"); return; }

  auth.signInWithEmailAndPassword(email,password)
    .then(cred=>{
      alert("Login sukses: "+cred.user.email);
      initUser(cred.user);
    })
    .catch(err=>alert("Gagal login: "+err.message));
}

function logoutUser(){
  auth.signOut().then(()=>{
    gameBox.style.display="none";
    loginForm.style.display="block";
    alert("Logout sukses!");
  });
}

// ===== INIT USER =====
function initUser(user){
  loginForm.style.display="none";
  gameBox.style.display="block";
  const userDoc = db.collection("users").doc(user.uid);
  userDoc.get().then(doc=>{
    if(doc.exists){
      balance = doc.data().balance;
    }else{
      userDoc.set({balance:1000000});
      balance = 1000000;
    }
    updateUI();
    loadHistory(user.uid);
    loadChat();
  });
}

// ===== UI =====
function updateUI(){
  balanceEl.innerText = "Rp "+balance.toLocaleString("id-ID");
  betEl.innerText = "Rp "+bet.toLocaleString("id-ID");
}

function setBet(amount, btn){
  bet = amount;
  updateUI();
  document.querySelectorAll(".controls button.bet").forEach(b=>b.classList.remove("selected"));
  btn.classList.add("selected");
}

// ===== SLOT =====
function randomSymbol(){ return symbols[Math.floor(Math.random()*symbols.length)]; }

function createReels(){
  slot.innerHTML="";
  for(let i=0;i<5;i++){
    const reel=document.createElement("div");
    reel.className="reel";
    const inner=document.createElement("div");
    inner.className="reel-inner";
    for(let j=0;j<10;j++){
      const sym=document.createElement("div");
      sym.className="symbol";
      sym.innerText=randomSymbol();
      inner.appendChild(sym);
    }
    reel.appendChild(inner);
    slot.appendChild(reel);
  }
}

function spin(){
  if(balance<bet && freeSpins===0) return alert("Saldo habis!");
  if(freeSpins===0) balance-=bet; else {freeSpins--; alert("ðŸŽ FREE SPIN! Sisa: "+freeSpins);}
  updateUI();

  const reels=document.querySelectorAll(".reel-inner");
  let crownCount=0;

  reels.forEach((reel,index)=>{
    reel.style.transition="none"; reel.style.top="0px";
    setTimeout(()=>{ reel.style.transition="top 1s ease-out"; reel.style.top="-350px"; }, index*200);
    setTimeout(()=>{
      reel.style.transition="none"; reel.style.top="0px"; reel.innerHTML="";
      for(let j=0;j<10;j++){
        const sym=document.createElement("div");
        sym.className="symbol";
        sym.innerText=randomSymbol();
        reel.appendChild(sym);
        if(sym.innerText==="ðŸ’Ž") crownCount++;
      }
    },1200+index*200);
  });

  setTimeout(()=>{
    let winAmount = 0;
    if(crownCount>=3){ 
      freeSpins+=5; 
      bonusMode=true; 
      document.body.classList.add("bonus-mode"); 
      alert("ðŸ”¥ FREE SPIN MODE AKTIF! 5 SPIN + WIN x10"); 
    }

    let winChance = Math.random();
    if(winChance>0.7){
      let multiplier = bonusMode?10:5;
      winAmount = bet*multiplier;
      balance+=winAmount;
      bigwinEl.style.display="block";
      setTimeout(()=>bigwinEl.style.display="none",1500);
      updateUI();
    }

    if(freeSpins===0){ bonusMode=false; document.body.classList.remove("bonus-mode"); }

    const user = auth.currentUser;
    if(user){
      const userRef = db.collection("users").doc(user.uid);
      userRef.set({balance:balance});
      // simpan history
      const spinData = {timestamp:Date.now(), bet:bet, win:winAmount};
      userRef.collection("history").add(spinData).then(()=>loadHistory(user.uid));
    }

  },1800);
}

// ===== HISTORY =====
function loadHistory(uid){
  historyDiv.innerHTML="";
  db.collection("users").doc(uid).collection("history").orderBy("timestamp","desc").limit(20).get()
    .then(snapshot=>{
      snapshot.forEach(doc=>{
        const data = doc.data();
        const time = new Date(data.timestamp).toLocaleTimeString();
        const entry = document.createElement("div");
        entry.innerText=`[${time}] Bet: ${data.bet} | Win: ${data.win}`;
        historyDiv.appendChild(entry);
      });
    });
}

// ===== LIVE CHAT =====
function sendMessage(){
  const msg = chatInput.value.trim();
  if(!msg) return;
  const user = auth.currentUser;
  if(!user) return alert("Login dulu untuk chat!");

  db.collection("chat").add({
    user: user.email,
    message: msg,
    timestamp: Date.now()
  }).then(()=>chatInput.value="");
}

function loadChat(){
  db.collection("chat").orderBy("timestamp","asc").onSnapshot(snapshot=>{
    chatContainer.innerHTML="";
    snapshot.forEach(doc=>{
      const data = doc.data();
      const time = new Date(data.timestamp).toLocaleTimeString();
      const bubble = document.createElement("div");
      bubble.className = data.user===auth.currentUser.email ? "chat-bubble chat-me" : "chat-bubble chat-other";
      bubble.innerHTML = `${data.message}<div class="chat-time">${time}</div>`;
      chatContainer.appendChild(bubble);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    });
  });
}
let currentCaptcha = "";

function generateCaptcha(){
  currentCaptcha = Math.random().toString(36).substring(2,7);
  document.getElementById("captchaText").innerText = currentCaptcha;
}
generateCaptcha();

function submitRegister(){

  let username = document.getElementById("regUsername").value;
  let email = document.getElementById("regEmail").value;
  let pass = document.getElementById("regPassword").value;
  let confirm = document.getElementById("regConfirm").value;
  let phone = document.getElementById("regPhone").value;
  let bank = document.getElementById("regBank").value;
  let rekName = document.getElementById("regRekName").value;
  let rekNo = document.getElementById("regRekNo").value;
  let captchaInput = document.getElementById("captchaInput").value;

  if(!username || !email || !pass || !phone){
    alert("Isi semua data wajib!");
    return;
  }

  if(pass !== confirm){
    alert("Password tidak sama!");
    return;
  }

  if(captchaInput !== currentCaptcha){
    alert("Captcha salah!");
    generateCaptcha();
    return;
  }

  // ===== BUAT AKUN AUTH =====
  auth.createUserWithEmailAndPassword(email,pass)
    .then(cred=>{

      // ===== SIMPAN DATA KE FIRESTORE =====
      db.collection("users").doc(cred.user.uid).set({
        username: username,
        email: email,
        phone: phone,
        bank: bank,
        rekName: rekName,
        rekNo: rekNo,
        balance: 10000, // saldo awal
        createdAt: Date.now()
      });

      alert("Register Berhasil ðŸ”¥ Saldo Awal 10.000");
      generateCaptcha();

    })
    .catch(err=>{
      alert("Gagal register: "+err.message);
    });


// ===== AUTO LOGIN =====
auth.onAuthStateChanged(user=>{
  if(user){

    alert("USER LOGIN TERDETEKSI");

    loginForm.style.display = "none";
    registerBox.style.display = "none";

    gameBox.style.display = "block";

    db.collection("users").doc(user.uid).get().then(doc=>{
      if(doc.exists){
        balance = doc.data().balance;
        updateUI();
      }
    });

    loadChat();

  } else {
    loginForm.style.display = "block";
    registerBox.style.display = "block";
    gameBox.style.display = "none";
  }
});
// ===== INIT =====
createReels();
updateUI();
</script>
</body>
</html>
